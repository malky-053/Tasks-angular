<div class="board-wrapper">
    <div class="board-top-bar">
        <div class="board-title-section">
            <button class="btn-back" (click)="goBackToProjects()" title="×—×–×•×¨ ×œ×¤×¨×•×™×§×˜×™×">
                â† ×—×–×•×¨
            </button>
            <h1>×œ×•×— ××©×™××•×ª - {{ projectName() }}</h1>
        </div>
        <button class="btn-primary" (click)="openCreateDialog()">+ ××©×™××” ×—×“×©×”</button>
    </div>

    <div class="search-container">
        <input type="text" placeholder="ğŸ” ×—×¤×© ××©×™××•×ª..." [(ngModel)]="searchQuery" class="search-input">
    </div>

    @if (isLoading()) {
    <div class="loader-container">
        <div class="spinner"></div>
        <p>×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
    </div>
    } @else {

    <div class="kanban-grid" cdkDropListGroup>

        <section class="kanban-column">
            <div class="column-header">
                <div class="status-indicator todo"></div>
                <h2>×œ×‘×™×¦×•×¢</h2>
                <span class="count-badge">{{ todoTasks().length }}</span>
                <button class="btn-sort-priority" (click)="toggleSortByPriority('todo')"
                    [class.active]="sortByPriority()['todo']" title="××™×•×Ÿ ×œ×¤×™ ×¢×“×™×¤×•×ª">â¬‡ï¸</button>
            </div>

            <div class="column-content" cdkDropList [cdkDropListData]="todoTasks()"
                (cdkDropListDropped)="onTaskDropped($event, 'todo')">
                <button class="btn-add-inline" (click)="openCreateDialog('todo')">
                    + ×”×•×¡×£ ××©×™××”
                </button>
                @for (item of todoTasks(); track item.id) {
                <div class="draggable-item-wrapper" cdkDrag [cdkDragData]="item">
                    <app-task-card [task]="item" (taskClicked)="openEditDialog($event)"></app-task-card>
                    <div *cdkDragPlaceholder class="custom-placeholder"></div>
                </div>
                }


            </div>
        </section>

        <section class="kanban-column">
            <div class="column-header">
                <div class="status-indicator progress"></div>
                <h2>×‘×¢×‘×•×“×”</h2>
                <span class="count-badge">{{ inProgressTasks().length }}</span>
                <button class="btn-sort-priority" (click)="toggleSortByPriority('in-progress')"
                    [class.active]="sortByPriority()['in-progress']" title="××™×•×Ÿ ×œ×¤×™ ×¢×“×™×¤×•×ª">â¬‡ï¸</button>
            </div>

            <div class="column-content" cdkDropList [cdkDropListData]="inProgressTasks()"
                (cdkDropListDropped)="onTaskDropped($event, 'in-progress')">

                <button class="btn-add-inline" (click)="openCreateDialog('in-progress')">
                    + ×”×•×¡×£ ××©×™××”
                </button>

                @for (item of inProgressTasks(); track item.id) {
                <div class="draggable-item-wrapper" cdkDrag [cdkDragData]="item">
                    <app-task-card [task]="item" (taskClicked)="openEditDialog($event)"></app-task-card>
                    <div *cdkDragPlaceholder class="custom-placeholder"></div>
                </div>
                }
            </div>
        </section>

        <section class="kanban-column">
            <div class="column-header">
                <div class="status-indicator done"></div>
                <h2>×”×•×©×œ×</h2>
                <span class="count-badge">{{ doneTasks().length }}</span>
                <button class="btn-sort-priority" (click)="toggleSortByPriority('done')"
                    [class.active]="sortByPriority()['done']" title="××™×•×Ÿ ×œ×¤×™ ×¢×“×™×¤×•×ª">â¬‡ï¸</button>
            </div>

            <div class="column-content" cdkDropList [cdkDropListData]="doneTasks()"
                (cdkDropListDropped)="onTaskDropped($event, 'done')">

                <button class="btn-add-inline" (click)="openCreateDialog('done')">
                    + ×”×•×¡×£ ××©×™××”
                </button>

                @for (item of doneTasks(); track item.id) {
                <div class="draggable-item-wrapper" cdkDrag [cdkDragData]="item">
                    <app-task-card [task]="item" (taskClicked)="openEditDialog($event)"></app-task-card>
                    <div *cdkDragPlaceholder class="custom-placeholder"></div>
                </div>
                }


            </div>
        </section>

    </div>
    }

    @if (showDialog()) {
    <app-task-dialog [projectId]="projectId()!" [taskToEdit]="selectedTask()" [initialStatus]="initialStatus()"
        (closed)="showDialog.set(false)" (saved)="onTaskSaved()">
    </app-task-dialog>
    }
</div>